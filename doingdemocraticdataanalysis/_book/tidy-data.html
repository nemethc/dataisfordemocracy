<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Tidy Data | Doing Democratic Data Analysis</title>
  <meta name="description" content="An opinionated guide to data analysis for public administrators and policy analysts" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Tidy Data | Doing Democratic Data Analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An opinionated guide to data analysis for public administrators and policy analysts" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Tidy Data | Doing Democratic Data Analysis" />
  
  <meta name="twitter:description" content="An opinionated guide to data analysis for public administrators and policy analysts" />
  

<meta name="author" content="Corban Nemeth" />


<meta name="date" content="2020-06-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="thinking-in-pivots.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.13/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<script src="libs/jszip-1.10.20/jszip.min.js"></script>
<link href="libs/dt-ext-buttons-1.10.20/css/buttons.dataTables.min.css" rel="stylesheet" />
<script src="libs/dt-ext-buttons-1.10.20/js/dataTables.buttons.min.js"></script>
<script src="libs/dt-ext-buttons-1.10.20/js/buttons.flash.min.js"></script>
<script src="libs/dt-ext-buttons-1.10.20/js/buttons.html5.min.js"></script>
<script src="libs/dt-ext-buttons-1.10.20/js/buttons.colVis.min.js"></script>
<script src="libs/dt-ext-buttons-1.10.20/js/buttons.print.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/jquery-ui-1.11.4/jquery-ui.min.css" rel="stylesheet" />
<script src="libs/jquery-ui-1.11.4/jquery-ui.min.js"></script>
<script src="libs/jquery-ui-1.11.4/jquery.ui.touch-punch.min.js"></script>
<link href="libs/c3-0.4.11/c3.min.css" rel="stylesheet" />
<script src="libs/c3-0.4.11/c3.min.js"></script>
<script src="libs/d3-3.5.5/d3.v3.min.js"></script>
<link href="libs/pivottable-2.19.0/pivot.min.css" rel="stylesheet" />
<script src="libs/pivottable-2.19.0/pivot.min.js"></script>
<script src="libs/pivottable-2.19.0/d3_renderers.min.js"></script>
<script src="libs/pivottable-2.19.0/c3_renderers.min.js"></script>
<script src="libs/pivottable-2.19.0/pivot.cs.min.js"></script>
<script src="libs/pivottable-2.19.0/pivot.da.min.js"></script>
<script src="libs/pivottable-2.19.0/pivot.de.min.js"></script>
<script src="libs/pivottable-2.19.0/pivot.es.min.js"></script>
<script src="libs/pivottable-2.19.0/pivot.fr.min.js"></script>
<script src="libs/pivottable-2.19.0/pivot.it.min.js"></script>
<script src="libs/pivottable-2.19.0/pivot.nl.min.js"></script>
<script src="libs/pivottable-2.19.0/pivot.pl.min.js"></script>
<script src="libs/pivottable-2.19.0/pivot.pt.min.js"></script>
<script src="libs/pivottable-2.19.0/pivot.ru.min.js"></script>
<script src="libs/pivottable-2.19.0/pivot.sq.min.js"></script>
<script src="libs/pivottable-2.19.0/pivot.tr.min.js"></script>
<script src="libs/pivottable-2.19.0/pivot.zh.min.js"></script>
<link href="libs/subtotal-1.10.0/subtotal.min.css" rel="stylesheet" />
<script src="libs/subtotal-1.10.0/subtotal.min.js"></script>
<script src="libs/polyfill-0.1/polyfill.min.js"></script>
<link href="libs/rpivotTable_style-0.1/rpivotTable.css" rel="stylesheet" />
<script src="libs/rpivotTable-binding-0.3.0/rpivotTable.js"></script>

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
.row { display: flex; }
.collapse { display: none; }
.in { display:block }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Doing Democratic Data Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#principles-and-practices"><i class="fa fa-check"></i><b>1.1</b> Principles and Practices</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#what-is-data-analysis"><i class="fa fa-check"></i><b>1.2</b> What is data analysis?</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#what-is-democratic-data-analysis"><i class="fa fa-check"></i><b>1.3</b> What is democratic data analysis?</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#tools-and-techniques"><i class="fa fa-check"></i><b>1.4</b> Tools and Techniques</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tidy-data.html"><a href="tidy-data.html"><i class="fa fa-check"></i><b>2</b> Tidy Data</a><ul>
<li class="chapter" data-level="2.1" data-path="tidy-data.html"><a href="tidy-data.html#the-grammar-of-tidy-data"><i class="fa fa-check"></i><b>2.1</b> The Grammar of Tidy Data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="tidy-data.html"><a href="tidy-data.html#fields"><i class="fa fa-check"></i><b>2.1.1</b> Fields</a></li>
<li class="chapter" data-level="2.1.2" data-path="tidy-data.html"><a href="tidy-data.html#variables"><i class="fa fa-check"></i><b>2.1.2</b> Variables</a></li>
<li class="chapter" data-level="2.1.3" data-path="tidy-data.html"><a href="tidy-data.html#observations"><i class="fa fa-check"></i><b>2.1.3</b> Observations</a></li>
<li class="chapter" data-level="2.1.4" data-path="tidy-data.html"><a href="tidy-data.html#values"><i class="fa fa-check"></i><b>2.1.4</b> Values</a></li>
<li class="chapter" data-level="2.1.5" data-path="tidy-data.html"><a href="tidy-data.html#tables"><i class="fa fa-check"></i><b>2.1.5</b> Tables</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="tidy-data.html"><a href="tidy-data.html#cleaning-and-tidying"><i class="fa fa-check"></i><b>2.2</b> Cleaning and Tidying</a></li>
<li class="chapter" data-level="2.3" data-path="tidy-data.html"><a href="tidy-data.html#tidying"><i class="fa fa-check"></i><b>2.3</b> Tidying</a></li>
<li class="chapter" data-level="2.4" data-path="tidy-data.html"><a href="tidy-data.html#tidy-data--from-wide-to-long"><i class="fa fa-check"></i><b>2.4</b> Tidy Data- From Wide to Long</a></li>
<li class="chapter" data-level="2.5" data-path="tidy-data.html"><a href="tidy-data.html#using-lower-level-data"><i class="fa fa-check"></i><b>2.5</b> Using lower level data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="thinking-in-pivots.html"><a href="thinking-in-pivots.html"><i class="fa fa-check"></i><b>3</b> Thinking in Pivots</a><ul>
<li class="chapter" data-level="3.1" data-path="thinking-in-pivots.html"><a href="thinking-in-pivots.html#pivot-tables-and-the-meaning-of-everything"><i class="fa fa-check"></i><b>3.1</b> Pivot Tables and the Meaning of Everything</a></li>
<li class="chapter" data-level="3.2" data-path="thinking-in-pivots.html"><a href="thinking-in-pivots.html#groups-and-summaries"><i class="fa fa-check"></i><b>3.2</b> Groups and Summaries</a></li>
<li class="chapter" data-level="3.3" data-path="thinking-in-pivots.html"><a href="thinking-in-pivots.html#conclusion"><i class="fa fa-check"></i><b>3.3</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reproducible-analysis.html"><a href="reproducible-analysis.html"><i class="fa fa-check"></i><b>4</b> Reproducible Analysis</a><ul>
<li class="chapter" data-level="4.1" data-path="reproducible-analysis.html"><a href="reproducible-analysis.html#do-it-for-your-future-self"><i class="fa fa-check"></i><b>4.1</b> Do It For Your Future Self</a><ul>
<li class="chapter" data-level="4.1.1" data-path="reproducible-analysis.html"><a href="reproducible-analysis.html#do-not-destroy"><i class="fa fa-check"></i><b>4.1.1</b> Do Not Destroy</a></li>
<li class="chapter" data-level="4.1.2" data-path="reproducible-analysis.html"><a href="reproducible-analysis.html#healthy-habits-for-reproducability"><i class="fa fa-check"></i><b>4.1.2</b> Healthy Habits for Reproducability</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="reproducible-analysis.html"><a href="reproducible-analysis.html#reproducible-resources"><i class="fa fa-check"></i><b>4.2</b> Reproducible Resources</a><ul>
<li class="chapter" data-level="4.2.1" data-path="reproducible-analysis.html"><a href="reproducible-analysis.html#gitgithub"><i class="fa fa-check"></i><b>4.2.1</b> Git/GitHub</a></li>
<li class="chapter" data-level="4.2.2" data-path="reproducible-analysis.html"><a href="reproducible-analysis.html#code-based-solutions-even-when-the-code-is-hidden"><i class="fa fa-check"></i><b>4.2.2</b> Code based solutions (even when the code is hidden)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="uncertainty-oriented-analysis.html"><a href="uncertainty-oriented-analysis.html"><i class="fa fa-check"></i><b>5</b> Uncertainty Oriented Analysis</a><ul>
<li class="chapter" data-level="5.1" data-path="uncertainty-oriented-analysis.html"><a href="uncertainty-oriented-analysis.html#embracing-uncertainty-for-better-outcomes"><i class="fa fa-check"></i><b>5.1</b> Embracing Uncertainty for Better Outcomes</a></li>
<li class="chapter" data-level="5.2" data-path="uncertainty-oriented-analysis.html"><a href="uncertainty-oriented-analysis.html#incorporating-uncertainty-into-models"><i class="fa fa-check"></i><b>5.2</b> Incorporating Uncertainty Into Models</a></li>
<li class="chapter" data-level="5.3" data-path="uncertainty-oriented-analysis.html"><a href="uncertainty-oriented-analysis.html#how-does-this-impact-democratic-data-analysis"><i class="fa fa-check"></i><b>5.3</b> How does this impact democratic data analysis?</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="audience-focused.html"><a href="audience-focused.html"><i class="fa fa-check"></i><b>6</b> Audience-Focused</a><ul>
<li class="chapter" data-level="6.1" data-path="audience-focused.html"><a href="audience-focused.html#considerations-for-public-sector-analysis"><i class="fa fa-check"></i><b>6.1</b> Considerations for Public Sector Analysis</a></li>
<li class="chapter" data-level="6.2" data-path="audience-focused.html"><a href="audience-focused.html#an-introduction-to-literate-data-analysis"><i class="fa fa-check"></i><b>6.2</b> An Introduction to Literate Data Analysis</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="applications-and-resources.html"><a href="applications-and-resources.html"><i class="fa fa-check"></i><b>7</b> Applications and Resources</a><ul>
<li class="chapter" data-level="7.1" data-path="applications-and-resources.html"><a href="applications-and-resources.html#applications-of-democratic-data-analysis"><i class="fa fa-check"></i><b>7.1</b> Applications of Democratic Data Analysis</a></li>
<li class="chapter" data-level="7.2" data-path="applications-and-resources.html"><a href="applications-and-resources.html#additional-resources"><i class="fa fa-check"></i><b>7.2</b> Additional Resources</a><ul>
<li class="chapter" data-level="7.2.1" data-path="applications-and-resources.html"><a href="applications-and-resources.html#r"><i class="fa fa-check"></i><b>7.2.1</b> R</a></li>
<li class="chapter" data-level="7.2.2" data-path="applications-and-resources.html"><a href="applications-and-resources.html#excel"><i class="fa fa-check"></i><b>7.2.2</b> Excel</a></li>
<li class="chapter" data-level="7.2.3" data-path="applications-and-resources.html"><a href="applications-and-resources.html#reproduciblity"><i class="fa fa-check"></i><b>7.2.3</b> Reproduciblity</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Doing Democratic Data Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tidy-data" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Tidy Data</h1>
<p>Tidy data refers to having your data organized in a specific manner suitable for analysis. This chapter will walk through common problems and approaches to cleaning and tidying your data. Keeping your data in a tidy format for analysis will help because it is a fundamentally flexible way of working with data. Keeping scattered, lose data in spreadsheets is a sure way to cause confusion for yourself and others.</p>
<div class="figure">
<img src="images/spreadsheet_hell.png" alt="" />
<p class="caption">spreadsheet hell</p>
</div>
<p>*Image courtesy of <a href="https://www.hive9.com/blog/just-say-no-to-spreadsheets">hive9.com</a></p>
<div id="the-grammar-of-tidy-data" class="section level2">
<h2><span class="header-section-number">2.1</span> The Grammar of Tidy Data<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></h2>
<p>Democratic data analysis has an underlying structure, like a sentence. Rules exist so sentences (hopefully) make sense to you, the reader. Similarly, by following common conventions of democratic data analysis, others will be able to “read” your analysis like you are reading this sentence. And also, like grammar, you can and should break the rules– but it helps to know them first.</p>
<p>Here are a couple definitions that will help as you move through this text. Don’t worry about memorizing them, as I will refer back to these definitions frequently.</p>
<div id="fields" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Fields</h3>
<p>A field is a fancy name for a column.</p>
<p>From here on out, <strong>every calculation, manipulation, formula, will be operated on a field</strong>.</p>
<p>I want you to forget that you could ever modify a lonely cell in Excel. No more formulas in cells. No more typing in values to a cell. Certainly no more writing over data in a cell. And for the love of everything that is good, no more color coding cells. Democratic data analysis depends on formulas that work on entire fields. Everything you would need to do to a single cell in Excel can– and should!– be done to an entire column. This may sound extreme and restrictive, but this approach will pay big dividends in your democratic data analysis journey and ultimately allow you to be more creative in your analysis.</p>
</div>
<div id="variables" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Variables</h3>
<p>A variable is something in your data that can change. That’s it! Variables become very important when looking at how to structure your data. Each variable should have its own field (column).</p>
</div>
<div id="observations" class="section level3">
<h3><span class="header-section-number">2.1.3</span> Observations</h3>
<p>Observations make up the rows of your data set. Each observation should correspond to a specific “thing.” This will make more sense later, I promise.</p>
</div>
<div id="values" class="section level3">
<h3><span class="header-section-number">2.1.4</span> Values</h3>
<p>Values are the actual data in your table.</p>
<p>Each value belongs to 1 (one) (uno) observation and 1 (one) variable. That’s it.</p>
<p>This means, among other things, no more merged cells, merged rows, or groups. A one-to-one relationship between fields and observations is critical for getting the most out of your data analysis.</p>
</div>
<div id="tables" class="section level3">
<h3><span class="header-section-number">2.1.5</span> Tables</h3>
<p>A table is the grouping of all observations of a similar type.</p>
<p>The table sets the foundation for analyzing your data. <strong>If I could only convince you of one thing, it would be the value in keeping your data in a table-based excel format</strong>. If you are trying to do math or statistics (again, not data analysis. These things are different!), then the table based framework can sometimes fall short. But if you are concerned with working with data to draw conclusions, then tables are the way to go.</p>
<p>You may already be able to see how these definitions foreshadow some of what is coming in later sections. For example, there are no references to cells. This is intentional. The most important distinction between democratic data analysis and simply working in excel is that in democratic data analysis, (virtually) <em>everything</em> is done on the <code>field</code> level. Changes are made to entire columns, calculations are made on entire columns. Thinking in <code>fields</code> is the first step on the path to democratic data enlightenment. Having data formatted in the structure outlined above forces good data hygiene that will be very helpful later on when discussing reproduciblity and pivot-ability.</p>
</div>
</div>
<div id="cleaning-and-tidying" class="section level2">
<h2><span class="header-section-number">2.2</span> Cleaning and Tidying</h2>
<p>I hate cleaning, but love tidying. Unfortunately, as in with life, one must clean before one tidies. But let’s start with some conceptual definitions.</p>
<p>Cleaning refers to the process of scrubbing the data into a way that makes sense to you, the analyst. Oftentimes, and especially in public sector organizations, the data is not clean. Whether you are looking at the output of a Survey Monkey survey or a canned report that is run from the IT department, your data will come in all shapes and sizes. Cleaning data is the process of transforming data values into ones that make sense for the purposes of your analysis.</p>
<p>Here is the first major departure from what you may have been taught about data analysis in Excel. When you get messy data <em>do not</em> change individual cell values. Recall from the introductory chapter the difference between cells and fields. Fields, as a reminder, are columns that represent one variable. Use data analysis tools to make changes to the entire field, rather than specific cells.</p>
<p>Most data analysis software, outside of Excel, make it difficult or impossible to change individual cell values. At first glance, this can seem unnecessary, limiting, and supremely annoying. But it’s actually very helpful. Thinking in terms of fields, and making changes to entire fields, will save you <em>a lot</em> of work and headache in the long run.</p>
<p>Let’s look at a sample dataset that may be similar to one you would encounter in real life. Here is a survey collected by a field manager of a local parks and recreation department on employment.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="tidy-data.html#cb1-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="tidy-data.html#cb1-2"></a><span class="kw">library</span>(DT)</span>
<span id="cb1-3"><a href="tidy-data.html#cb1-3"></a></span>
<span id="cb1-4"><a href="tidy-data.html#cb1-4"></a>sites &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb1-5"><a href="tidy-data.html#cb1-5"></a>  <span class="op">~</span><span class="st">&quot;Employee&quot;</span>, <span class="op">~</span><span class="st">&quot;Location&quot;</span>, <span class="op">~</span><span class="st">&quot;Telecommute?&quot;</span>, <span class="op">~</span><span class="st">&quot;Hire Date&quot;</span>,</span>
<span id="cb1-6"><a href="tidy-data.html#cb1-6"></a>  <span class="st">&quot;ron swanson&quot;</span>, <span class="st">&quot;Pawnee City Hall&quot;</span>, <span class="st">&quot;never&quot;</span>, <span class="st">&quot;Unknown&quot;</span>,</span>
<span id="cb1-7"><a href="tidy-data.html#cb1-7"></a>  <span class="st">&quot;Knope, Leslie&quot;</span>, <span class="st">&quot;Field Duty&quot;</span>, <span class="st">&quot;1 day/week&quot;</span>, <span class="st">&quot;2011-6-1&quot;</span>,</span>
<span id="cb1-8"><a href="tidy-data.html#cb1-8"></a>  <span class="st">&quot;Andy Dwyer&quot;</span>, <span class="st">&quot;sullivan street pit&quot;</span>, <span class="st">&quot;40 hours&quot;</span>, <span class="st">&quot;March 1, 2013&quot;</span>,</span>
<span id="cb1-9"><a href="tidy-data.html#cb1-9"></a>  <span class="st">&quot;Jerry Gergich&quot;</span>, <span class="st">&quot;City Hall&quot;</span>, <span class="st">&quot;never&quot;</span>, <span class="st">&quot;6/1/1985&quot;</span>,</span>
<span id="cb1-10"><a href="tidy-data.html#cb1-10"></a>  <span class="st">&quot;Garry Gergich&quot;</span>, <span class="st">&quot;City Hall&quot;</span>, <span class="st">&quot;never&quot;</span>, <span class="st">&quot;6/1/1985&quot;</span>,</span>
<span id="cb1-11"><a href="tidy-data.html#cb1-11"></a>  <span class="st">&quot;ben wyatt&quot;</span>, <span class="st">&quot;Partridge, Minnesota&quot;</span>,<span class="st">&quot;&quot;</span> , <span class="st">&quot;Jan. 1, 2010&quot;</span></span>
<span id="cb1-12"><a href="tidy-data.html#cb1-12"></a>)</span>
<span id="cb1-13"><a href="tidy-data.html#cb1-13"></a></span>
<span id="cb1-14"><a href="tidy-data.html#cb1-14"></a>sites <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">datatable</span>(</span>
<span id="cb1-15"><a href="tidy-data.html#cb1-15"></a>    <span class="dt">extensions =</span> <span class="st">&#39;Buttons&#39;</span>, </span>
<span id="cb1-16"><a href="tidy-data.html#cb1-16"></a>    <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">dom =</span> <span class="st">&#39;Bfrtip&#39;</span>, </span>
<span id="cb1-17"><a href="tidy-data.html#cb1-17"></a>                   <span class="dt">buttons =</span> <span class="st">&#39;excel&#39;</span>,</span>
<span id="cb1-18"><a href="tidy-data.html#cb1-18"></a>                   <span class="dt">searching =</span> <span class="ot">FALSE</span>))</span></code></pre></div>
<div id="htmlwidget-baf3ce5623d759a1f312" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-baf3ce5623d759a1f312">{"x":{"filter":"none","extensions":["Buttons"],"data":[["1","2","3","4","5","6"],["ron swanson","Knope, Leslie","Andy Dwyer","Jerry Gergich","Garry Gergich","ben wyatt"],["Pawnee City Hall","Field Duty","sullivan street pit","City Hall","City Hall","Partridge, Minnesota"],["never","1 day/week","40 hours","never","never",""],["Unknown","2011-6-1","March 1, 2013","6/1/1985","6/1/1985","Jan. 1, 2010"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Employee<\/th>\n      <th>Location<\/th>\n      <th>Telecommute?<\/th>\n      <th>Hire Date<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"Bfrtip","buttons":["excel"],"searching":false,"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>
<p>In this example, it would be trivial to go in to the Excel file and clean up the dates, names, and locations by hand. However, you could imagine this survey replicated for a department of forty employees. It quickly becomes unfeasible to make those edits by hand. When this is the case, there are functions in Excel and R that will make your life much easier.</p>
<p>Here is annotated code for how I would go about cleaning this table in R. The friendly syntax of the <code>tidyverse</code> packages makes it easy to follow along, even if you aren’t comfortable writing it yourself. You can accomplish all these similar transformations using <a href="https://support.microsoft.com/en-us/office/power-query-101-008b3f46-5b14-4f8b-9a07-d3da689091b5">Get &amp; Transform in Excel</a>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="tidy-data.html#cb2-1"></a><span class="co">#creating a new table called &quot;sites_cleaned&quot;, starting with the old table &quot;sites&quot;</span></span>
<span id="cb2-2"><a href="tidy-data.html#cb2-2"></a>sites_cleaned &lt;-<span class="st"> </span>sites <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-3"><a href="tidy-data.html#cb2-3"></a><span class="st">  </span><span class="co">#switching the order of names that are backwards</span></span>
<span id="cb2-4"><a href="tidy-data.html#cb2-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Employee =</span> <span class="kw">if_else</span>(Employee <span class="op">==</span><span class="st"> &quot;Knope, Leslie&quot;</span>, <span class="st">&quot;Leslie Knope&quot;</span>, Employee)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-5"><a href="tidy-data.html#cb2-5"></a><span class="st">  </span><span class="co">#separate employee names into two columns</span></span>
<span id="cb2-6"><a href="tidy-data.html#cb2-6"></a><span class="st">  </span><span class="kw">separate</span>(Employee, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;first_name&quot;</span>, <span class="st">&quot;last_name&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-7"><a href="tidy-data.html#cb2-7"></a><span class="st">  </span><span class="co">#renaming column names to standard format</span></span>
<span id="cb2-8"><a href="tidy-data.html#cb2-8"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">location =</span> Location,</span>
<span id="cb2-9"><a href="tidy-data.html#cb2-9"></a>         <span class="dt">telecommute_hours =</span><span class="st">`</span><span class="dt">Telecommute?</span><span class="st">`</span>,</span>
<span id="cb2-10"><a href="tidy-data.html#cb2-10"></a>         <span class="dt">hire_date =</span> <span class="st">`</span><span class="dt">Hire Date</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-11"><a href="tidy-data.html#cb2-11"></a><span class="st">  </span><span class="co">#changing first and last names and locations to Title Case</span></span>
<span id="cb2-12"><a href="tidy-data.html#cb2-12"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">first_name =</span> <span class="kw">str_to_title</span>(first_name),</span>
<span id="cb2-13"><a href="tidy-data.html#cb2-13"></a>         <span class="dt">last_name =</span> <span class="kw">str_to_title</span>(last_name),</span>
<span id="cb2-14"><a href="tidy-data.html#cb2-14"></a>         <span class="dt">location =</span> <span class="kw">str_to_title</span>(location)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-15"><a href="tidy-data.html#cb2-15"></a><span class="st">  </span><span class="co">#coding location data to three categories, In Office, In Field, or Other</span></span>
<span id="cb2-16"><a href="tidy-data.html#cb2-16"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">location =</span> <span class="kw">case_when</span>(</span>
<span id="cb2-17"><a href="tidy-data.html#cb2-17"></a>           <span class="kw">str_detect</span>(location, <span class="st">&quot;City Hall&quot;</span>) <span class="op">~</span><span class="st"> &quot;In Office&quot;</span>,</span>
<span id="cb2-18"><a href="tidy-data.html#cb2-18"></a>           <span class="kw">str_detect</span>(location, <span class="st">&quot;Field&quot;</span>) <span class="op">~</span><span class="st"> &quot;In Field&quot;</span>,</span>
<span id="cb2-19"><a href="tidy-data.html#cb2-19"></a>           <span class="kw">str_detect</span>(location, <span class="st">&quot;Street&quot;</span>) <span class="op">~</span><span class="st"> &quot;In Field&quot;</span>,</span>
<span id="cb2-20"><a href="tidy-data.html#cb2-20"></a>           <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;Other&quot;</span>),</span>
<span id="cb2-21"><a href="tidy-data.html#cb2-21"></a>  <span class="co">#coding hours to numeric</span></span>
<span id="cb2-22"><a href="tidy-data.html#cb2-22"></a>         <span class="dt">telecommute_hours =</span> <span class="kw">case_when</span>(</span>
<span id="cb2-23"><a href="tidy-data.html#cb2-23"></a>           telecommute_hours <span class="op">==</span><span class="st"> &quot;never&quot;</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb2-24"><a href="tidy-data.html#cb2-24"></a>           telecommute_hours <span class="op">==</span><span class="st"> &quot;1 day/week&quot;</span> <span class="op">~</span><span class="st"> </span><span class="dv">8</span>,</span>
<span id="cb2-25"><a href="tidy-data.html#cb2-25"></a>           telecommute_hours <span class="op">==</span><span class="st"> &quot;40 hours&quot;</span> <span class="op">~</span><span class="st"> </span><span class="dv">40</span></span>
<span id="cb2-26"><a href="tidy-data.html#cb2-26"></a>         )</span>
<span id="cb2-27"><a href="tidy-data.html#cb2-27"></a>         )</span>
<span id="cb2-28"><a href="tidy-data.html#cb2-28"></a></span>
<span id="cb2-29"><a href="tidy-data.html#cb2-29"></a><span class="co">#print to datatable</span></span>
<span id="cb2-30"><a href="tidy-data.html#cb2-30"></a>sites_cleaned<span class="op">%&gt;%</span><span class="st"> </span><span class="kw">datatable</span>(</span>
<span id="cb2-31"><a href="tidy-data.html#cb2-31"></a>    <span class="dt">extensions =</span> <span class="st">&#39;Buttons&#39;</span>, </span>
<span id="cb2-32"><a href="tidy-data.html#cb2-32"></a>    <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">dom =</span> <span class="st">&#39;Bfrtip&#39;</span>, </span>
<span id="cb2-33"><a href="tidy-data.html#cb2-33"></a>                   <span class="dt">buttons =</span> <span class="st">&#39;excel&#39;</span>,</span>
<span id="cb2-34"><a href="tidy-data.html#cb2-34"></a>                   <span class="dt">searching =</span> <span class="ot">FALSE</span>))</span></code></pre></div>
<div id="htmlwidget-4dc7ed8f037c835a1fcd" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4dc7ed8f037c835a1fcd">{"x":{"filter":"none","extensions":["Buttons"],"data":[["1","2","3","4","5","6"],["Ron","Leslie","Andy","Jerry","Garry","Ben"],["Swanson","Knope","Dwyer","Gergich","Gergich","Wyatt"],["In Office","In Field","In Field","In Office","In Office","Other"],[0,8,40,0,0,null],["Unknown","2011-6-1","March 1, 2013","6/1/1985","6/1/1985","Jan. 1, 2010"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>first_name<\/th>\n      <th>last_name<\/th>\n      <th>location<\/th>\n      <th>telecommute_hours<\/th>\n      <th>hire_date<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"Bfrtip","buttons":["excel"],"searching":false,"columnDefs":[{"className":"dt-right","targets":4},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>This may seem like a lot of work for a small table. But as your data grows, it is much easier to operate on entire fields at a time. This is especially true in Get &amp; Transform, which makes it very easy to transform and clean data using all the same steps as the <code>R</code> code above. As you can see, our table is now “cleaned” and organized consistently.</p>
</div>
<div id="tidying" class="section level2">
<h2><span class="header-section-number">2.3</span> Tidying</h2>
<p>Tidy data is the way your data should be organized before you begin your analysis. In tidy data, each column is a <em>variable</em>, each row is an <em>observation</em>, and each table is an <em>associated set of observations</em>. What does that mean in practice? Consider the following example.</p>
<p>Below is a table<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> that shows types of retirement visits for a month at a state’s Department of Retirement Services by the employee who took the visit and the visit type.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="tidy-data.html#cb3-1"></a><span class="co">#build sample data table</span></span>
<span id="cb3-2"><a href="tidy-data.html#cb3-2"></a>visits &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb3-3"><a href="tidy-data.html#cb3-3"></a>  <span class="op">~</span><span class="st">&quot;Employee&quot;</span>, <span class="op">~</span><span class="st">&quot;Phone Visits&quot;</span>, <span class="op">~</span><span class="st">&quot;Office Visits&quot;</span>, <span class="op">~</span><span class="st">&quot;Online Visits&quot;</span>,</span>
<span id="cb3-4"><a href="tidy-data.html#cb3-4"></a>  <span class="st">&quot;Danielle&quot;</span>, <span class="dv">6</span>, <span class="dv">11</span>, <span class="dv">23</span>,</span>
<span id="cb3-5"><a href="tidy-data.html#cb3-5"></a>  <span class="st">&quot;Ramona&quot;</span>, <span class="dv">11</span>, <span class="dv">5</span>, <span class="dv">18</span>,</span>
<span id="cb3-6"><a href="tidy-data.html#cb3-6"></a>  <span class="st">&quot;Ross&quot;</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span> </span>
<span id="cb3-7"><a href="tidy-data.html#cb3-7"></a>)</span>
<span id="cb3-8"><a href="tidy-data.html#cb3-8"></a></span>
<span id="cb3-9"><a href="tidy-data.html#cb3-9"></a><span class="co">#print to datatable</span></span>
<span id="cb3-10"><a href="tidy-data.html#cb3-10"></a>visits<span class="op">%&gt;%</span><span class="st"> </span><span class="kw">datatable</span>(</span>
<span id="cb3-11"><a href="tidy-data.html#cb3-11"></a>    <span class="dt">extensions =</span> <span class="st">&#39;Buttons&#39;</span>, </span>
<span id="cb3-12"><a href="tidy-data.html#cb3-12"></a>    <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">dom =</span> <span class="st">&#39;Bfrtip&#39;</span>, </span>
<span id="cb3-13"><a href="tidy-data.html#cb3-13"></a>                   <span class="dt">buttons =</span> <span class="st">&#39;excel&#39;</span>,</span>
<span id="cb3-14"><a href="tidy-data.html#cb3-14"></a>                   <span class="dt">searching =</span> <span class="ot">FALSE</span>),</span>
<span id="cb3-15"><a href="tidy-data.html#cb3-15"></a>                   <span class="dt">caption =</span> <span class="st">&quot;Visits to the Dept. of Retirement Services in a given month by employee&quot;</span></span>
<span id="cb3-16"><a href="tidy-data.html#cb3-16"></a>                   )</span></code></pre></div>
<div id="htmlwidget-e4a24e263871c1a5c171" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e4a24e263871c1a5c171">{"x":{"filter":"none","extensions":["Buttons"],"caption":"<caption>Visits to the Dept. of Retirement Services in a given month by employee<\/caption>","data":[["1","2","3"],["Danielle","Ramona","Ross"],[6,11,10],[11,5,10],[23,18,10]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Employee<\/th>\n      <th>Phone Visits<\/th>\n      <th>Office Visits<\/th>\n      <th>Online Visits<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"Bfrtip","buttons":["excel"],"searching":false,"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Data are frequently displayed in this “wide” format. It works great for presentation, but not great for data analysis.</p>
<p>The shortcomings of data in this format may become apparent when you attempt to work with the data in a pivot table. This is because our columns aren’t truly variables. Remember, variables are elements of an observation that can change. You can drag the fields from the top row to the gray box below, for columns, and the left, for rows. This becomes unmanageable quickly.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="tidy-data.html#cb4-1"></a>rpivotTable<span class="op">::</span><span class="kw">rpivotTable</span>(visits, <span class="dt">width =</span> <span class="st">&quot;60%&quot;</span>, <span class="dt">height =</span> <span class="st">&quot;60%&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-7858df86327ea0424001" style="width:60%;height:60%;" class="rpivotTable html-widget"></div>
<script type="application/json" data-for="htmlwidget-7858df86327ea0424001">{"x":{"data":{"Employee":["Danielle","Ramona","Ross"],"Phone Visits":[6,11,10],"Office Visits":[11,5,10],"Online Visits":[23,18,10]},"params":{},"locale":"en","subtotals":false},"evals":[],"jsHooks":[]}</script>
</div>
<div id="tidy-data--from-wide-to-long" class="section level2">
<h2><span class="header-section-number">2.4</span> Tidy Data- From Wide to Long</h2>
<p>Let’s apply our criteria of tidy data to this set:</p>
<ul>
<li>Variables
<ul>
<li>At first glance, it doesn’t look like this is a problem. But think again. Is <code>phone visits</code> really a variable? Or is the real variable of interest number of visits? And are our column names are actually variables too (type of visit)?</li>
</ul></li>
</ul>
<p>Let’s take another swing at setting up our table for data analysis purposes. This can be accomplished easily in R using the code below, or in Excel by loading the data with <a href="https://support.microsoft.com/en-us/office/unpivot-columns-power-query-0f7bad4b-9ea1-49c1-9d95-f588221c7098"><code>Get and Transform</code></a> -&gt; selecting the three “visits” columns -&gt; right clicking -&gt; and selecting “unpivot columns.”</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="tidy-data.html#cb5-1"></a><span class="co">#We have already loaded the &quot;tidyverse&quot; library so we do not have to do it again</span></span>
<span id="cb5-2"><a href="tidy-data.html#cb5-2"></a><span class="co">#we are editing the &quot;visits&quot; table already created by storing it in a new table pivot_visits</span></span>
<span id="cb5-3"><a href="tidy-data.html#cb5-3"></a>pivot_visits &lt;-<span class="st"> </span>visits <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-4"><a href="tidy-data.html#cb5-4"></a><span class="st">  </span><span class="co">#using pivot_longer on every column except &quot;employee&quot; and setting the name of the new columns</span></span>
<span id="cb5-5"><a href="tidy-data.html#cb5-5"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>Employee, <span class="dt">names_to =</span> <span class="st">&quot;Visit Type&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;Number of Visits&quot;</span>) </span>
<span id="cb5-6"><a href="tidy-data.html#cb5-6"></a></span>
<span id="cb5-7"><a href="tidy-data.html#cb5-7"></a></span>
<span id="cb5-8"><a href="tidy-data.html#cb5-8"></a>knitr<span class="op">::</span><span class="kw">kable</span>(pivot_visits, <span class="dt">caption =</span> <span class="st">&quot;Visits to the Dept. of Retirement Services in a given month&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-3">Table 2.1: </span>Visits to the Dept. of Retirement Services in a given month</caption>
<thead>
<tr class="header">
<th align="left">Employee</th>
<th align="left">Visit Type</th>
<th align="right">Number of Visits</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Danielle</td>
<td align="left">Phone Visits</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Danielle</td>
<td align="left">Office Visits</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">Danielle</td>
<td align="left">Online Visits</td>
<td align="right">23</td>
</tr>
<tr class="even">
<td align="left">Ramona</td>
<td align="left">Phone Visits</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">Ramona</td>
<td align="left">Office Visits</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">Ramona</td>
<td align="left">Online Visits</td>
<td align="right">18</td>
</tr>
<tr class="odd">
<td align="left">Ross</td>
<td align="left">Phone Visits</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">Ross</td>
<td align="left">Office Visits</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">Ross</td>
<td align="left">Online Visits</td>
<td align="right">10</td>
</tr>
</tbody>
</table>
<p>Now this is a table that is much easier to analyze in an Excel pivot table or with a variety of R functions. However, it does look worse and is less intuitive for human readers. Thankfully, using data in this format, it is easy to recreate the original table for presentation, while also giving a variety of options for formatting and plotting. Use the pivot table below to recreate the original table using the tidy data. *Hint- Instead of Count, select Sum -&gt; Number of Visits as the value field. It is far easier to work with fields when they are in a tidy format.</p>
</div>
<div id="using-lower-level-data" class="section level2">
<h2><span class="header-section-number">2.5</span> Using lower level data</h2>
<p>Let’s introduce a slightly more complicated tidy data problem, using the same base data as before.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="tidy-data.html#cb6-1"></a>visits_retirements &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb6-2"><a href="tidy-data.html#cb6-2"></a>  <span class="op">~</span><span class="st">&quot;Employee&quot;</span>, <span class="op">~</span><span class="st">&quot;Phone Visits&quot;</span>, <span class="op">~</span><span class="st">&quot;Phone Retirements&quot;</span>, <span class="op">~</span><span class="st">&quot;Office Visits&quot;</span>, <span class="op">~</span><span class="st">&quot;Office Retirements&quot;</span>, <span class="op">~</span><span class="st">&quot;Online Visits&quot;</span>, <span class="op">~</span><span class="st">&quot;Online Retirements&quot;</span>,</span>
<span id="cb6-3"><a href="tidy-data.html#cb6-3"></a>  <span class="st">&quot;Danielle&quot;</span>, <span class="dv">6</span>, <span class="dv">4</span>, <span class="dv">11</span>, <span class="dv">8</span>, <span class="dv">23</span>, <span class="dv">15</span>,</span>
<span id="cb6-4"><a href="tidy-data.html#cb6-4"></a>  <span class="st">&quot;Ramona&quot;</span>, <span class="dv">11</span>, <span class="dv">7</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">18</span>, <span class="dv">15</span>,</span>
<span id="cb6-5"><a href="tidy-data.html#cb6-5"></a>  <span class="st">&quot;Ross&quot;</span>, <span class="dv">10</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">9</span> </span>
<span id="cb6-6"><a href="tidy-data.html#cb6-6"></a>)</span></code></pre></div>
<p>Hopefully you will see a similar pattern here. Now, there are three variables: Visit type, number of visits, and number of retirements. Again, this data works fine for presentation but could use tidying to ease in analysis.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="tidy-data.html#cb7-1"></a>visits_retirements <span class="op">%&gt;%</span></span>
<span id="cb7-2"><a href="tidy-data.html#cb7-2"></a><span class="st">  </span>DT<span class="op">::</span><span class="kw">datatable</span>(</span>
<span id="cb7-3"><a href="tidy-data.html#cb7-3"></a>    <span class="dt">extensions =</span> <span class="st">&#39;Buttons&#39;</span>, </span>
<span id="cb7-4"><a href="tidy-data.html#cb7-4"></a>    <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">dom =</span> <span class="st">&#39;Bfrtip&#39;</span>, </span>
<span id="cb7-5"><a href="tidy-data.html#cb7-5"></a>                   <span class="dt">buttons =</span> <span class="st">&#39;excel&#39;</span>,</span>
<span id="cb7-6"><a href="tidy-data.html#cb7-6"></a>                   <span class="dt">searching =</span> <span class="ot">FALSE</span>))</span></code></pre></div>
<div id="htmlwidget-ff8767c6d3bd5f7f76fe" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ff8767c6d3bd5f7f76fe">{"x":{"filter":"none","extensions":["Buttons"],"data":[["1","2","3"],["Danielle","Ramona","Ross"],[6,11,10],[4,7,8],[11,5,10],[8,3,7],[23,18,10],[15,15,9]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Employee<\/th>\n      <th>Phone Visits<\/th>\n      <th>Phone Retirements<\/th>\n      <th>Office Visits<\/th>\n      <th>Office Retirements<\/th>\n      <th>Online Visits<\/th>\n      <th>Online Retirements<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"Bfrtip","buttons":["excel"],"searching":false,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Try to tidy this in R or Excel Get and Transform. See this footnote<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> or look at the code if you need a hint.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="tidy-data.html#cb8-1"></a>visits_retirements_tidy &lt;-<span class="st"> </span>visits_retirements <span class="op">%&gt;%</span></span>
<span id="cb8-2"><a href="tidy-data.html#cb8-2"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="op">-</span>Employee, </span>
<span id="cb8-3"><a href="tidy-data.html#cb8-3"></a>               <span class="dt">names_to =</span> <span class="kw">c</span>(<span class="st">&quot;Visit Location&quot;</span>, <span class="st">&quot;Type&quot;</span>), </span>
<span id="cb8-4"><a href="tidy-data.html#cb8-4"></a>               <span class="dt">names_sep =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb8-5"><a href="tidy-data.html#cb8-5"></a></span>
<span id="cb8-6"><a href="tidy-data.html#cb8-6"></a><span class="kw">print</span>(visits_retirements_tidy)</span></code></pre></div>
<pre><code>## # A tibble: 18 x 4
##    Employee `Visit Location` Type        value
##    &lt;chr&gt;    &lt;chr&gt;            &lt;chr&gt;       &lt;dbl&gt;
##  1 Danielle Phone            Visits          6
##  2 Danielle Phone            Retirements     4
##  3 Danielle Office           Visits         11
##  4 Danielle Office           Retirements     8
##  5 Danielle Online           Visits         23
##  6 Danielle Online           Retirements    15
##  7 Ramona   Phone            Visits         11
##  8 Ramona   Phone            Retirements     7
##  9 Ramona   Office           Visits          5
## 10 Ramona   Office           Retirements     3
## 11 Ramona   Online           Visits         18
## 12 Ramona   Online           Retirements    15
## 13 Ross     Phone            Visits         10
## 14 Ross     Phone            Retirements     8
## 15 Ross     Office           Visits         10
## 16 Ross     Office           Retirements     7
## 17 Ross     Online           Visits         10
## 18 Ross     Online           Retirements     9</code></pre>
<p>In this case, we actually pivoted too far. It will probably be more useful to have the counts of visits and retirements in their own category. Keep in mind the scope of the observation– It is perfectly valid for each to have their own column, as it is visits and retirements per month.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="tidy-data.html#cb10-1"></a>visits_retirements_tidy2 &lt;-<span class="st"> </span>visits_retirements_tidy <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-2"><a href="tidy-data.html#cb10-2"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">id_cols =</span> <span class="kw">c</span>(Employee, <span class="st">`</span><span class="dt">Visit Location</span><span class="st">`</span>, Type), <span class="dt">names_from =</span> Type, <span class="dt">values_from =</span> value)</span>
<span id="cb10-3"><a href="tidy-data.html#cb10-3"></a></span>
<span id="cb10-4"><a href="tidy-data.html#cb10-4"></a><span class="kw">print</span>(visits_retirements_tidy2)</span></code></pre></div>
<pre><code>## # A tibble: 9 x 4
##   Employee `Visit Location` Visits Retirements
##   &lt;chr&gt;    &lt;chr&gt;             &lt;dbl&gt;       &lt;dbl&gt;
## 1 Danielle Phone                 6           4
## 2 Danielle Office               11           8
## 3 Danielle Online               23          15
## 4 Ramona   Phone                11           7
## 5 Ramona   Office                5           3
## 6 Ramona   Online               18          15
## 7 Ross     Phone                10           8
## 8 Ross     Office               10           7
## 9 Ross     Online               10           9</code></pre>
<p>From here, it is easy to do calculations based on fields, rather than cells. For example, in R or Get and Transform, you could add the following:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="tidy-data.html#cb12-1"></a>visits_pct &lt;-<span class="st"> </span>visits_retirements_tidy2 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-2"><a href="tidy-data.html#cb12-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pct_retirements =</span> Retirements <span class="op">/</span><span class="st"> </span>Visits)</span>
<span id="cb12-3"><a href="tidy-data.html#cb12-3"></a></span>
<span id="cb12-4"><a href="tidy-data.html#cb12-4"></a><span class="kw">print</span>(visits_pct)</span></code></pre></div>
<pre><code>## # A tibble: 9 x 5
##   Employee `Visit Location` Visits Retirements pct_retirements
##   &lt;chr&gt;    &lt;chr&gt;             &lt;dbl&gt;       &lt;dbl&gt;           &lt;dbl&gt;
## 1 Danielle Phone                 6           4           0.667
## 2 Danielle Office               11           8           0.727
## 3 Danielle Online               23          15           0.652
## 4 Ramona   Phone                11           7           0.636
## 5 Ramona   Office                5           3           0.6  
## 6 Ramona   Online               18          15           0.833
## 7 Ross     Phone                10           8           0.8  
## 8 Ross     Office               10           7           0.7  
## 9 Ross     Online               10           9           0.9</code></pre>
<p>And then, one of the most useful things you can do is develop formulas by grouping of rows. For example, you may want to know the total number of visits and retirements by retiree, regardless of visit location. That can be accomplished in a pivot table, which we will cover in the next section.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p>Adapted from Hadley Wickham’s paper on <a href="https://vita.had.co.nz/papers/tidy-data.pdf">Tidy Data</a><a href="tidy-data.html#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Data was created for demonstration purposes<a href="tidy-data.html#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>powerquery hints<a href="tidy-data.html#fnref4" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="thinking-in-pivots.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["doingdemocraticdataanalysis.pdf", "doingdemocraticdataanalysis.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
